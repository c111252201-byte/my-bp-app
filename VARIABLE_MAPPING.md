# 變數對應說明

## 變數對應關係

### OCR 辨識關鍵字 → 系統變數 → 公式變數

| OCR 關鍵字 | 中文名稱 | 系統變數 | 公式變數 | 說明 |
|-----------|---------|---------|---------|------|
| **SYS** | 收縮壓 | `systolic` | **y** | 血壓測量的上壓 |
| **DIA** | 舒張壓 | `diastolic` | **x** | 血壓測量的下壓 |
| **PULSE** | 脈拍 | `pulse` | - | 每分鐘心跳次數 |

## 公式使用說明

在 Google Sheets 的「工作表二」的 **C2** 儲存格中：

- **x** = 舒張壓（DIA）
- **y** = 收縮壓（SYS）

### 範例公式

如果您的公式是：`y=1.1421x+30.744`

在 C2 儲存格中輸入（**移除等號和 y=**）：
```
1.1421*x+30.744
```

## 判斷邏輯

系統會按照以下步驟判斷：

1. **OCR 辨識**：從圖片中識別 SYS、DIA、PULSE
2. **解析數值**：
   - SYS → 收縮壓（systolic）→ 公式中的 **y**
   - DIA → 舒張壓（diastolic）→ 公式中的 **x**
   - PULSE → 脈拍（pulse）→ 僅顯示，不參與計算
3. **計算公式**：
   - 將 x（舒張壓）和 y（收縮壓）代入公式
   - 例如：`1.1421*x+30.744` → `1.1421*80+30.744` = `122.112`
4. **計算差值**：
   - `|計算結果 - y|` = `|122.112 - 120|` = `2.112`
5. **與基準值比較**：
   - 如果差值 ≤ B7：顯示「正常」
   - 如果差值 > B7：顯示「不正常」

## OCR 辨識格式支援

系統支援以下格式的 OCR 辨識：

### SYS（收縮壓）格式
- `SYS:120`
- `SYS 120`
- `SYS=120`
- `SYS120`
- `sys:120`（不區分大小寫）

### DIA（舒張壓）格式
- `DIA:80`
- `DIA 80`
- `DIA=80`
- `DIA80`
- `dia:80`（不區分大小寫）

### PULSE（脈拍）格式
- `PULSE:80`
- `PULSE 80`
- `PULSE=80`
- `PULSE80`
- `P:80` 或 `BPM:80`（也支援）
- `pulse:80`（不區分大小寫）

## 完整範例

### OCR 辨識結果範例
```
SYS:120
DIA:80
PULSE:72
```

### 解析結果
- 收縮壓（y）= 120
- 舒張壓（x）= 80
- 脈拍 = 72

### 公式計算（假設公式為 `1.1421*x+30.744`）
- 計算：`1.1421*80+30.744` = `122.112`
- 差值：`|122.112 - 120|` = `2.112`
- 如果 B7 = 10，則 `2.112 ≤ 10`，顯示「正常」

## 注意事項

1. **公式格式**：在 Google Sheets 的 C2 中，**不要加等號**，直接輸入公式
2. **變數名稱**：公式中必須使用 `x`（舒張壓）和 `y`（收縮壓）
3. **乘法運算**：乘法必須使用 `*`，例如 `1.1421*x` 不能寫成 `1.1421x`
4. **數值驗證**：系統會驗證解析到的數值是否合理
   - 收縮壓：50-300
   - 舒張壓：30-200
   - 脈拍：30-200

## 錯誤處理

如果 OCR 無法識別 SYS 或 DIA，系統會：
1. 嘗試其他解析方法（數字/數字格式、數字排序等）
2. 如果都失敗，顯示錯誤訊息：「無法從 OCR 結果中解析血壓數值。請確認圖片清晰，且包含 SYS（收縮壓）和 DIA（舒張壓）標示」





